<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gestión de Reservas - Cabañas</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="style.css">
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
</head>
<body>
  <!-- PANTALLA DE LOGIN -->
  <div id="login-view" class="login-container">
    <div class="login-box">
      <h1><i class="fas fa-key"></i> Acceso al Sistema</h1>
      <form id="login-form">
        <input 
          type="password" 
          id="password-input" 
          placeholder="Ingresa la contraseña" 
          autocomplete="off"
          required
        >
        <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 20px;">
          <i class="fas fa-sign-in-alt"></i> Acceder
        </button>
      </form>
      <p id="login-error" class="login-error" style="display: none;">Contraseña incorrecta</p>
    </div>
  </div>

  <!-- VISTA PRINCIPAL: Tarjetas de cabañas -->
  <div id="main-view" class="view hidden">
    <div class="header">
      <h1>Gestión de Reservas</h1>
      <p class="subtitle">Sistema de administración de cabañas turísticas</p>
    </div>

    <!-- HEATMAP DE OCUPACIÓN MENSUAL -->
    <div class="ocupacion-heatmap-container">
      <h2>Ocupación del Mes</h2>
      <div class="heatmap-mes-nav">
        <button class="btn-mes-nav" id="btn-prev-mes">◀</button>
        <div class="ocupacion-heatmap-mes" id="ocupacion-mes"></div>
        <button class="btn-mes-nav" id="btn-next-mes">▶</button>
      </div>
      <div class="ocupacion-heatmap-wrapper">
        <div class="ocupacion-heatmap-labels">
          <div class="label-cabana" id="ocupacion-labels"></div>
        </div>
        <div class="ocupacion-heatmap-grid" id="ocupacion-heatmap">
          <!-- Se generará con JavaScript -->
        </div>
      </div>

    </div>

    <div class="main-buttons">
      <button id="btn-ver-clientes" class="btn btn-info">
        <i class="fas fa-users"></i> Clientes
      </button>
    </div>

    <div class="cabanas-grid" id="cabanas-grid">
      <!-- Las tarjetas se generarán con JavaScript -->
    </div>
  </div>

  <!-- VISTA CALENDARIO: Calendario mensual de cabaña seleccionada -->
  <div id="edit-cabana-modal" class="modal hidden">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Editar Cabaña</h3>
        <button class="btn-close" onclick="closeEditCabanaModal()">✕</button>
      </div>
      <div class="modal-body">
        <form id="form-edit-cabana">
          <input type="hidden" id="edit-cabana-id">
          
          <label for="edit-cabana-numero">Número de Cabaña:</label>
          <input type="number" id="edit-cabana-numero" required disabled>
          
          <label for="edit-cabana-capacidad">Capacidad (personas):</label>
          <input type="number" id="edit-cabana-capacidad" min="1" required>
          
          <label for="edit-cabana-precio">Precio Base ($/noche):</label>
          <input type="number" id="edit-cabana-precio" min="0" step="0.01" required>
          
          <label for="edit-cabana-descripcion">Descripción:</label>
          <textarea id="edit-cabana-descripcion" rows="3"></textarea>
          
          <div class="modal-buttons">
            <button type="submit" class="btn btn-primary">Guardar Cambios</button>
            <button type="button" class="btn btn-secondary" onclick="closeEditCabanaModal()">Cancelar</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <div id="clientes-view" class="view hidden">
    <div class="clientes-header">
      <button id="btn-volver-clientes" class="btn btn-secondary">
        <i class="fas fa-arrow-left"></i> Volver
      </button>
      <h2>Gestión de Clientes</h2>
      <button id="btn-export-clientes" class="btn btn-primary">
        <i class="fas fa-download"></i> Exportar Excel
      </button>
    </div>
    
    <div class="tabs-container">
      <div class="tabs-nav">
        <button class="tab-button active" data-tab="tab-clientes">
          <i class="fas fa-users"></i> Clientes
        </button>
        <button class="tab-button" data-tab="tab-notas">
          <i class="fas fa-sticky-note"></i> Notas
        </button>
        <button class="tab-button" data-tab="tab-pagos">
          <i class="fas fa-credit-card"></i> Pagos
        </button>
      </div>
      
      <div class="tabs-content">
        <!-- TAB 1: CLIENTES -->
        <div id="tab-clientes" class="tab-pane active">
          <div id="clientes-list" class="clientes-table">
            <!-- Se generará con JavaScript -->
          </div>
        </div>
        
        <!-- TAB 2: NOTAS -->
        <div id="tab-notas" class="tab-pane">
          <div id="notas-list" class="notas-table">
            <!-- Se generará con JavaScript -->
          </div>
        </div>
        
        <!-- TAB 3: PAGOS -->
        <div id="tab-pagos" class="tab-pane">
          <div id="pagos-list" class="pagos-table">
            <!-- Se generará con JavaScript -->
          </div>
        </div>
      </div>
    </div>
  </div>

  <div id="calendar-view" class="view hidden">
    <div class="calendar-header">
      <button id="btn-volver" class="btn btn-secondary">
        <i class="fas fa-arrow-left"></i> Volver
      </button>
      <div class="calendar-title">
        <h2 id="cabana-nombre"></h2>
        <p id="mes-anio"></p>
      </div>
      <button id="btn-add-reserva" class="btn btn-primary">
        <i class="fas fa-plus"></i> Agregar Reserva
      </button>
    </div>

    <div class="calendar-nav">
      <button id="btn-prev-mes-calendar" class="btn btn-outline">
        <i class="fas fa-chevron-left"></i>
      </button>
      <span id="current-mes-anio" class="mes-anio-display"></span>
      <button id="btn-next-mes-calendar" class="btn btn-outline">
        <i class="fas fa-chevron-right"></i>
      </button>
    </div>

    <div class="calendar-weekdays">
      <div class="weekday">Lun</div>
      <div class="weekday">Mar</div>
      <div class="weekday">Mié</div>
      <div class="weekday">Jue</div>
      <div class="weekday">Vie</div>
      <div class="weekday">Sáb</div>
      <div class="weekday">Dom</div>
    </div>

    <div class="calendar-grid" id="calendar-grid">
      <!-- Los días se generarán con JavaScript -->
    </div>
  </div>

  <!-- MODAL: Agregar/Editar Reserva -->
  <div id="modal-reserva" class="modal hidden">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="modal-titulo">Nueva Reserva</h3>
        <button id="btn-close-modal" class="btn-close">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <form id="form-reserva" class="form-reserva">
        <!-- Sección: Datos del Cliente -->
        <div class="form-section">
          <h4>Datos del Cliente</h4>
          <div class="form-group">
            <label for="cliente-nombre">Nombre del Cliente *</label>
            <input type="text" id="cliente-nombre" placeholder="Ej: Juan García" required>
          </div>
          <div class="form-group">
            <label for="cliente-telefono">Teléfono *</label>
            <input type="tel" id="cliente-telefono" placeholder="Ej: +54 9 11 1234567" required>
          </div>
          <div class="form-group">
            <label for="cantidad-personas">Cantidad de Personas *</label>
            <input type="number" id="cantidad-personas" min="1" placeholder="Ej: 4" required>
          </div>
        </div>

        <!-- Sección: Fechas y Días -->
        <div class="form-section">
          <h4>Fechas y Ocupación</h4>
          <div class="form-group">
            <label for="fecha-inicio">Fecha Inicio *</label>
            <input type="date" id="fecha-inicio" required>
          </div>
          <div class="form-group">
            <label for="fecha-fin">Fecha Fin *</label>
            <input type="date" id="fecha-fin" required>
          </div>
          
          <div id="ocupacion-dias" class="ocupacion-dias">
            <!-- Se generarán los controles AM/PM aquí -->
          </div>
        </div>

        <!-- Sección: Pago -->
        <div class="form-section">
          <h4>Información de Pago</h4>
          <div class="form-group">
            <label for="estado-pago">Estado de Pago *</label>
            <select id="estado-pago" required>
              <option value="pendiente">Pendiente</option>
              <option value="pagado">Pagado</option>
              <option value="parcial">Parcial</option>
            </select>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="monto-total">Monto Total ($) *</label>
              <input type="number" id="monto-total" min="0" step="0.01" placeholder="0.00" required>
            </div>
            <div class="form-group">
              <label for="monto-pagado">Monto Pagado ($)</label>
              <input type="number" id="monto-pagado" min="0" step="0.01" placeholder="0.00">
            </div>
          </div>
          <div class="form-group">
            <label for="notas">Notas Adicionales</label>
            <textarea id="notas" placeholder="Ej: Requiere cuna para bebé" rows="3"></textarea>
          </div>
        </div>

        <div class="form-actions">
          <button type="button" id="btn-cancel-modal" class="btn btn-secondary">Cancelar</button>
          <button type="submit" class="btn btn-primary">Guardar Reserva</button>
        </div>
      </form>
    </div>
  </div>

  <!-- MODAL: Editar Reserva (click en día ocupado) -->
  <div id="modal-edit-reserva" class="modal hidden">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Editar Reserva</h3>
        <button id="btn-close-edit-modal" class="btn-close">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <form id="form-edit-reserva" class="form-reserva">
        <div class="form-section">
          <h4>Datos del Cliente</h4>
          <div class="form-group">
            <label for="edit-cliente-nombre">Nombre del Cliente *</label>
            <input type="text" id="edit-cliente-nombre" required>
          </div>
          <div class="form-group">
            <label for="edit-cliente-telefono">Teléfono *</label>
            <input type="tel" id="edit-cliente-telefono" required>
          </div>
          <div class="form-group">
            <label for="edit-cantidad-personas">Cantidad de Personas *</label>
            <input type="number" id="edit-cantidad-personas" min="1" required>
          </div>
        </div>

        <div class="form-section">
          <h4>Fechas y Ocupación</h4>
          <div class="form-group">
            <label for="edit-fecha-inicio">Fecha Inicio *</label>
            <input type="date" id="edit-fecha-inicio" required>
          </div>
          <div class="form-group">
            <label for="edit-fecha-fin">Fecha Fin *</label>
            <input type="date" id="edit-fecha-fin" required>
          </div>
          <div id="edit-ocupacion-dias" class="ocupacion-dias"></div>
        </div>

        <div class="form-section">
          <h4>Información de Pago</h4>
          <div class="form-group">
            <label for="edit-estado-pago">Estado de Pago *</label>
            <select id="edit-estado-pago" required>
              <option value="pendiente">Pendiente</option>
              <option value="pagado">Pagado</option>
              <option value="parcial">Parcial</option>
            </select>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="edit-monto-total">Monto Total ($) *</label>
              <input type="number" id="edit-monto-total" min="0" step="0.01" required>
            </div>
            <div class="form-group">
              <label for="edit-monto-pagado">Monto Pagado ($)</label>
              <input type="number" id="edit-monto-pagado" min="0" step="0.01">
            </div>
          </div>
          <div class="form-group">
            <label for="edit-notas">Notas Adicionales</label>
            <textarea id="edit-notas" rows="3"></textarea>
          </div>
        </div>

        <div class="form-actions">
          <button type="button" id="btn-delete-reserva" class="btn btn-danger">Eliminar Reserva</button>
          <button type="button" id="btn-cancel-edit-modal" class="btn btn-secondary">Cancelar</button>
          <button type="submit" class="btn btn-primary">Guardar Cambios</button>
        </div>
      </form>
    </div>
  </div>

  <!-- MODAL: Pago Parcial -->
  <div id="modal-pago-parcial" class="modal hidden">
    <div class="modal-content" style="max-width: 400px;">
      <div class="modal-header">
        <h3>Registrar Pago Parcial</h3>
        <button id="btn-close-pago-modal" class="btn-close">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <form id="form-pago-parcial" class="form-reserva">
        <div class="form-section">
          <div class="form-group">
            <label for="pago-cliente-nombre">Cliente</label>
            <input type="text" id="pago-cliente-nombre" disabled style="background-color: #f5f5f5;">
          </div>
          <div class="form-group">
            <label for="pago-monto-total">Monto Total ($)</label>
            <input type="text" id="pago-monto-total" disabled style="background-color: #f5f5f5;">
          </div>
          <div class="form-group">
            <label for="pago-monto-pagado">Monto ya Pagado ($)</label>
            <input type="text" id="pago-monto-pagado" disabled style="background-color: #f5f5f5;">
          </div>
          <div class="form-group">
            <label for="pago-deuda-actual">Deuda Actual ($)</label>
            <input type="text" id="pago-deuda-actual" disabled style="background-color: #f5f5f5;">
          </div>
          <div class="form-group">
            <label for="pago-monto-nuevo">Monto a Pagar Ahora ($) *</label>
            <input type="number" id="pago-monto-nuevo" min="0.01" step="0.01" placeholder="0.00" required>
          </div>
        </div>
        <div class="form-actions">
          <button type="button" id="btn-cancel-pago-modal" class="btn btn-secondary">Cancelar</button>
          <button type="submit" class="btn btn-primary">Registrar Pago</button>
        </div>
      </form>
    </div>
  </div>

  <!-- MODAL: Editar Cliente -->
  <div id="modal-editar-cliente" class="modal hidden">
    <div class="modal-content" style="max-width: 400px;">
      <div class="modal-header">
        <h3>Editar Cliente</h3>
        <button id="btn-close-editar-cliente-modal" class="btn-close">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <form id="form-editar-cliente" class="form-reserva">
        <div class="form-section">
          <div class="form-group">
            <label for="editar-cliente-nombre">Nombre *</label>
            <input type="text" id="editar-cliente-nombre" required>
          </div>
          <div class="form-group">
            <label for="editar-cliente-telefono">Teléfono *</label>
            <input type="tel" id="editar-cliente-telefono" required>
          </div>
        </div>
        <div class="form-actions">
          <button type="button" id="btn-cancel-editar-cliente-modal" class="btn btn-secondary">Cancelar</button>
          <button type="submit" class="btn btn-primary">Guardar Cambios</button>
        </div>
      </form>
    </div>
  </div>

  <!-- MODAL: Eliminar Cliente (Confirmación con contraseña) -->
  <div id="modal-eliminar-cliente" class="modal hidden">
    <div class="modal-content" style="max-width: 400px;">
      <div class="modal-header">
        <h3>Eliminar Cliente</h3>
        <button id="btn-close-eliminar-cliente-modal" class="btn-close">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="form-section">
        <p style="text-align: center; color: #666; margin-bottom: 20px;">
          <i class="fas fa-exclamation-triangle" style="color: #f44336; font-size: 2rem;"></i><br><br>
          ¿Estás seguro de que deseas eliminar este cliente?<br>
          Esta acción no se puede deshacer.
        </p>
        <div class="form-group">
          <label for="eliminar-cliente-clave">Ingresa la clave 71 para confirmar</label>
          <input type="password" id="eliminar-cliente-clave" placeholder="Clave" required>
        </div>
      </div>
      <div class="form-actions">
        <button type="button" id="btn-cancel-eliminar-cliente-modal" class="btn btn-secondary">Cancelar</button>
        <button type="button" id="btn-confirmar-eliminar-cliente" class="btn btn-danger">Eliminar Definitivamente</button>
      </div>
    </div>
  </div>

  <!-- Toast para notificaciones -->
  <div id="toast" class="toast hidden"></div>

  <script src="supabase.js"></script>
  <script src="calendar.js"></script>
  <script src="reservas.js"></script>
  <script src="app.js"></script>
</body>
</html>
